##
# MostoxDB V1 "core-deploy" | IaC example tutorial for microk8s MongoDB + Nginx structure | by mosto 
##
# For a IaC in microk8s, you need to define the configuration for the deployment and the service that will orquestate it.
##
apiVersion: apps/v1 # microk8s integrated api version for deployments
kind: Deployment # Type of resource, 'Deployment' makes a container
metadata:
  name: nginx # Name for the deployment
spec:
  replicas: 1 # Number copies to deploy
  selector: # The pods controled by this deployment
    matchLabels:
      app: nginx # This deployment controls the pods that match with the 'nginx' label
  template: # Template for crating the pod
    metadata:
      labels:
        app: nginx # Label of the pod
    spec: # Specs of the pod
      containers:
        - name: nginx # Container name
          image: nginx:alpine # Container image
          ports:
            - containerPort: 80 # Pod port
---
apiVersion: v1
kind: Service # # This resource configurate comunications between pods
metadata:
  name: nginx # Service name, hostname on the cluster
spec:
  type: NodePort
  selector:
    app: nginx # Trafic of the service will point to pods with the same label
  ports: # Port maping:
    - port: 80 # Service port
      targetPort: 80 # Pod port
      nodePort: 30080 # Node port. This will be the access port for the computer
